---
layout: post
title: 关于静态方法、单例模式以及连接池
categories: php
description: 关于静态方法、单例模式以及连接池。
keywords: php，静态方法，单例模式，连接池
---

### 起因

今天发现公司基本所有的php代码类都是用单例模式写的，虽说php比较灵活，不常驻内存，但是也不要这样滥用单例吧。。。。。。于是就有了这篇文章，简单分析一下什么时候用静态方法，什么时候用单例模式，以及php中大多数情况下都不会存在的连接池概念。


### 静态方法和非静态方法

- 静态方法在代码开始时进入内存，之后会常驻内存，而非静态方法会将实例化后的对象放在堆栈上，通过实例来调用方法
- 静态方法常驻内存，所有实例共用，而非静态方法与类实例挂钩
- 静态方法快一些，不过这种速度上的差异可以忽略不计

### 静态方法与非静态方法的使用场景

从上面的分析中可以看出：

- 当一个方法与他所在的类的实例无关的时候，那他就应该是静态的，比如一些工具类；
- 反之则是非静态的



### 单例

但是，有时候确实应该使用非静态方法,但是在创建类的时候又确实需要维护一份实例去使用面对对象的特性，这种情况下该怎么办？答案就是用单例模式。

打个比方，需要一份配置，这份配置是公共的，并且在整个生命周期都存在，只需要一份就可以，多个地方使用都需要new一个实例，这样做比较浪费内存，这时候就可以使用单例。

但是，单例也不能滥用。回去开头说的，公司代码基本所有类都是用单例写的，这样很容易出现问题，过用一个公司的内部SDK类，set了一下加密的key，但是在不同的地方用到，因此重新set了一下key，然后调用解密方法，发现解密失败，原因就在于此单例共用同一个属性。这在php中还比较少见，在java等其他常驻内存的语言中可能比较常见。因此要避免滥用单例。


### 什么情况下用单例

- 共用一个实例
- 生命周期不小于应用的生命周期
- 其实用php写的传统web应用，一般写了单例也没用，生命周期为一个请求，大部分情况下不会用到单例


### 题外话---连接池

那么问题来了，看到公司封装的DB连接类也是用的单例模式，仔细想了一下，其实除非做了切库相关操作，否则在非常驻内存的php（非cli模式）下，用处并不大。。。其实就算是常驻内存，也不应该用单例来实现数据库连接，否则每个web请求都用同个数据库连接。

这里顺便扯一下连接池。

连接池一般用在常驻内存的语言中，如java等，用于减少不断创建以及销毁连接所带来的系统开销。




